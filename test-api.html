<!DOCTYPE html>
<html>
<head>
    <title>Test Universal Game API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .response { background: #f5f5f5; padding: 10px; border-radius: 3px; white-space: pre-wrap; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
        .board { display: grid; grid-template-columns: repeat(3, 50px); gap: 2px; margin: 10px 0; }
        .cell { width: 50px; height: 50px; border: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Universal Game API Test</h1>
        
        <div class="section">
            <h2>1. –°–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∏–≥—Ä</h2>
            <button onclick="getSupportedGames()">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä</button>
            <div id="games-response" class="response"></div>
        </div>

        <div class="section">
            <h2>2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π</h2>
            <button onclick="createChessSession()">–°–æ–∑–¥–∞—Ç—å —à–∞—Ö–º–∞—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—é</button>
            <button onclick="createTicTacToeSession()">–°–æ–∑–¥–∞—Ç—å –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</button>
            <div id="session-response" class="response"></div>
        </div>

        <div class="section">
            <h2>3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π</h2>
            <input type="text" id="sessionId" placeholder="Session ID" style="width: 300px;">
            <br>
            <button onclick="getSessionState()">–ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
            <button onclick="deleteSession()">–£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
            <div id="session-state-response" class="response"></div>
        </div>

        <div class="section">
            <h2>4. –®–∞—Ö–º–∞—Ç—ã - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–æ–¥–æ–≤</h2>
            <button onclick="makeChessMove()">–°–¥–µ–ª–∞—Ç—å —Ö–æ–¥ e2-e4</button>
            <div id="chess-response" class="response"></div>
        </div>

        <div class="section">
            <h2>5. –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <div id="tictactoe-board" class="board">
                <div class="cell" onclick="makeTicTacToeMove(0,0)"></div>
                <div class="cell" onclick="makeTicTacToeMove(0,1)"></div>
                <div class="cell" onclick="makeTicTacToeMove(0,2)"></div>
                <div class="cell" onclick="makeTicTacToeMove(1,0)"></div>
                <div class="cell" onclick="makeTicTacToeMove(1,1)"></div>
                <div class="cell" onclick="makeTicTacToeMove(1,2)"></div>
                <div class="cell" onclick="makeTicTacToeMove(2,0)"></div>
                <div class="cell" onclick="makeTicTacToeMove(2,1)"></div>
                <div class="cell" onclick="makeTicTacToeMove(2,2)"></div>
            </div>
            <div id="tictactoe-response" class="response"></div>
        </div>

        <div class="section">
            <h2>6. AI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <input type="password" id="apiKey" placeholder="Google API Key" style="width: 300px;">
            <br>
            <button onclick="createChessForAI()">–°–æ–∑–¥–∞—Ç—å —à–∞—Ö–º–∞—Ç—ã –¥–ª—è AI —Ç–µ—Å—Ç–∞</button>
            <button onclick="makeChessMoveForAI()">–°–¥–µ–ª–∞—Ç—å —Ö–æ–¥ e2-e4</button>
            <button onclick="testAI()">–ü–æ–ª—É—á–∏—Ç—å —Ö–æ–¥ AI</button>
            <div id="ai-response" class="response"></div>
        </div>
    </div>

    <script>
        let currentSessionId = null;
        let currentTicTacToeSession = null;

        const API_BASE = 'http://localhost:3001/api';

        function displayResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.className = `response ${isError ? 'error' : 'success'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${url}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function getSupportedGames() {
            try {
                const data = await apiCall('/games');
                displayResponse('games-response', data);
            } catch (error) {
                displayResponse('games-response', { error: error.message }, true);
            }
        }

        async function createChessSession() {
            try {
                const data = await apiCall('/games/chess/sessions', {
                    method: 'POST',
                    body: JSON.stringify({
                        playerConfig: { name: 'Test Player', side: 'white' },
                        aiConfig: { difficulty: 'medium' }
                    })
                });
                currentSessionId = data.sessionId;
                document.getElementById('sessionId').value = currentSessionId;
                displayResponse('session-response', data);
            } catch (error) {
                displayResponse('session-response', { error: error.message }, true);
            }
        }

        async function createTicTacToeSession() {
            try {
                const data = await apiCall('/games/tictactoe/sessions', {
                    method: 'POST',
                    body: JSON.stringify({
                        playerConfig: { name: 'Test Player', symbol: 'x' },
                        aiConfig: { difficulty: 'medium' }
                    })
                });
                currentTicTacToeSession = data.sessionId;
                displayResponse('session-response', data);
                updateTicTacToeBoard(data.gameState.board);
            } catch (error) {
                displayResponse('session-response', { error: error.message }, true);
            }
        }

        async function getSessionState() {
            const sessionId = document.getElementById('sessionId').value;
            if (!sessionId) {
                displayResponse('session-state-response', { error: '–í–≤–µ–¥–∏—Ç–µ Session ID' }, true);
                return;
            }

            try {
                const data = await apiCall(`/sessions/${sessionId}`);
                displayResponse('session-state-response', data);
            } catch (error) {
                displayResponse('session-state-response', { error: error.message }, true);
            }
        }

        async function deleteSession() {
            const sessionId = document.getElementById('sessionId').value;
            if (!sessionId) {
                displayResponse('session-state-response', { error: '–í–≤–µ–¥–∏—Ç–µ Session ID' }, true);
                return;
            }

            try {
                const data = await apiCall(`/sessions/${sessionId}`, { method: 'DELETE' });
                displayResponse('session-state-response', data);
            } catch (error) {
                displayResponse('session-state-response', { error: error.message }, true);
            }
        }

        async function makeChessMove() {
            if (!currentSessionId) {
                displayResponse('chess-response', { error: '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —à–∞—Ö–º–∞—Ç–Ω—É—é —Å–µ—Å—Å–∏—é' }, true);
                return;
            }

            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é chess —Å–µ—Å—Å–∏—é, –ø—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ —ç—Ç–æ —à–∞—Ö–º–∞—Ç—ã
                const sessionData = await apiCall(`/sessions/${currentSessionId}`);
                
                const data = await apiCall(`/sessions/${currentSessionId}/moves`, {
                    method: 'POST',
                    body: JSON.stringify({
                        move: { from: 'e2', to: 'e4' }
                    })
                });
                displayResponse('chess-response', data);
            } catch (error) {
                displayResponse('chess-response', { error: error.message }, true);
            }
        }

        async function makeTicTacToeMove(row, col) {
            if (!currentTicTacToeSession) {
                displayResponse('tictactoe-response', { error: '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Å—Å–∏—é –∫—Ä–µ—Å—Ç–∏–∫–æ–≤-–Ω–æ–ª–∏–∫–æ–≤' }, true);
                return;
            }

            try {
                const data = await apiCall(`/sessions/${currentTicTacToeSession}/moves`, {
                    method: 'POST',
                    body: JSON.stringify({
                        move: { row, col }
                    })
                });
                displayResponse('tictactoe-response', data);
                if (data.gameState) {
                    updateTicTacToeBoard(data.gameState.board);
                }
            } catch (error) {
                displayResponse('tictactoe-response', { error: error.message }, true);
            }
        }

        function updateTicTacToeBoard(board) {
            const cells = document.querySelectorAll('#tictactoe-board .cell');
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const cellIndex = i * 3 + j;
                    cells[cellIndex].textContent = board[i][j] || '';
                }
            }
        }

        let chessSessionForAI = null;

        async function createChessForAI() {
            try {
                const data = await apiCall('/games/chess/sessions', {
                    method: 'POST',
                    body: JSON.stringify({
                        playerConfig: { name: 'AI Test Player', side: 'white' },
                        aiConfig: { difficulty: 'medium' }
                    })
                });
                chessSessionForAI = data.sessionId;
                displayResponse('ai-response', { message: '–®–∞—Ö–º–∞—Ç–Ω–∞—è —Å–µ—Å—Å–∏—è –¥–ª—è AI —Å–æ–∑–¥–∞–Ω–∞', sessionId: chessSessionForAI, gameState: data.gameState });
            } catch (error) {
                displayResponse('ai-response', { error: error.message }, true);
            }
        }

        async function makeChessMoveForAI() {
            if (!chessSessionForAI) {
                displayResponse('ai-response', { error: '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —à–∞—Ö–º–∞—Ç–Ω—É—é —Å–µ—Å—Å–∏—é –¥–ª—è AI' }, true);
                return;
            }

            try {
                const data = await apiCall(`/sessions/${chessSessionForAI}/moves`, {
                    method: 'POST',
                    body: JSON.stringify({
                        move: { from: 'e2', to: 'e4' }
                    })
                });
                displayResponse('ai-response', { message: '–•–æ–¥ e2-e4 —Å–¥–µ–ª–∞–Ω', result: data });
            } catch (error) {
                displayResponse('ai-response', { error: error.message }, true);
            }
        }

        async function testAI() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                displayResponse('ai-response', { error: '–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á' }, true);
                return;
            }

            if (!chessSessionForAI) {
                displayResponse('ai-response', { error: '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —à–∞—Ö–º–∞—Ç–Ω—É—é —Å–µ—Å—Å–∏—é –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ö–æ–¥' }, true);
                return;
            }

            try {
                const data = await apiCall(`/sessions/${chessSessionForAI}/ai-move`, {
                    method: 'POST',
                    body: JSON.stringify({
                        apiKey: apiKey,
                        model: 'gemini-2.5-pro-preview-05-06',
                        difficulty: 'medium'
                    })
                });
                displayResponse('ai-response', data);
            } catch (error) {
                displayResponse('ai-response', { error: error.message }, true);
            }
        }
    </script>
</body>
</html> 